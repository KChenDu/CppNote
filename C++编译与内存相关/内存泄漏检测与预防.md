1. 内存泄漏检测
	对于`C/C++`没有`GC`程序的语言来说因为内存造成的问题较多，当然一般情况下如果存在严重的内存泄漏，我们通过查看内存使用统计即可检测到内存泄漏，但是细小的内存泄漏很难通过统计观察到，目前一般都是利用各种内存检测工具来检测内存泄漏，当然关键还是在于统计和分析申请和释放的相关日志。内存检测工具有很多，这里重点介绍下`valgrind`。
	
	`valgrind`是一套`Linux`下，开放源代码（`GPL V2`）的仿真调试工具的集合，包括以下工具：
	- `Memcheck`：内存检查器（`valgrind`应用最广泛的工具），能够发现开发中绝大多数内存错误的使用情况，比如：使用未初始化的内存，使用已经释放了的内存，内存访问越界等。
	- `Memcheck`能够检测出内存问题，关键在于其建立了两个全局表：
		- `Valid-Value`表：对于进程的整个地址空间中的每一个字节（`byte`），都有与之对应的8个 `bits`；对于`CPU`的每个寄存器，也有一个与之对应的`bit`向量。这些`bits`负责记录该字节或者寄存器值是否具有有效的、已初始化的值。
		- `Valid-Address`表：对于进程整个地址空间中的每一个字节（`byte`），还有与之对应的1个`bit`，负责记录该地址是否能够被读写。
	- 检测原理：
		当要读写内存中某个字节时，首先检查这个字节对应的`Valid-Address`表中对应的`bit`。如果该`bit`显示该位置是无效位置，`Memcheck`则报告读写错误。
		内核（`core`）类似于一个虚拟的`CPU`环境，这样当内存中的某个字节被加载到真实的`CPU`中时，该字节在`Valid-Value`表对应的`bits`也被加载到虚拟的`CPU`环境中。一旦寄存器中的值，被用来产生内存地址，或者该值能够影响程序输出，则`Memcheck`会检查`Valid-Value`表对应的`bits`，如果该值尚未初始化，则会报告使用未初始化内存错误。
```sh
valgrind --tool=memcheck --leak-check=full ./2
```
2. 如何防止内存泄漏：
	- 使用智能指针：智能指针是`C++`中已经对内存泄漏封装好了一个工具，智能指针对象会自动释放所申请的内存。
	- 良好的编码习惯：良好的编码习惯可以有效的避免内存泄漏的问题，内存申请和释放要一一对应。
		- 在 C++ 中需要将基类的析构函数定义为虚函数；
		- 遵循`RAII`（`Resource acquisition is initialization`）原则：在对象构造时获取资源，在对象生命期控制对资源的访问使之始终保持有效，最后在对象析构的时候释放资源；
		- 尽量使用智能指针；
		- 有效引入内存检测工具；

[返回](C++编译与内存相关/readme)